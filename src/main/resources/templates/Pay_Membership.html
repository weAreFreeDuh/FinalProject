<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="gloria">
    <meta name="date" content="">
    <meta name="description" content="">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="shortcut icon" href="/favicon/favicon.ico" type="image/x-icon">

    <script src="https://kit.fontawesome.com/8591377d67.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://kit.fontawesome.com/8591377d67.css" crossorigin="anonymous">

    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <link rel="shortcut icon" href="favicon.ico">

    <link href="https://fonts.googleapis.com/css?family=Quicksand:300,400,500,700" rel="stylesheet">

    <!-- Animate.css -->
    <link rel="stylesheet" href="css/main/animate.css">
    <!-- Icomoon Icon Fonts-->
    <link rel="stylesheet" href="css/main/icomoon.css">
    <!-- Bootstrap  -->
    <link rel="stylesheet" href="css/main/bootstrap.css">
    <!-- Flexslider  -->
    <link rel="stylesheet" href="css/main/flexslider.css">
    <!-- Flaticons  -->
    <link rel="stylesheet" href="fonts/flaticon/font/flaticon.css">
    <!-- Owl Carousel -->
    <link rel="stylesheet" href="css/main/owl.carousel.min.css">
    <link rel="stylesheet" href="css/main/owl.theme.default.min.css">
    <!-- Theme style  -->
    <link rel="stylesheet" href="css/main/style.css">

    <link rel="stylesheet" href="css/header.css">

    <link rel="stylesheet" href="css/membership.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/all.min.css">

    <!-- script
    ================================================== -->
    <script src="js/modernizr.js"></script>

    <!-- Modernizr JS -->
    <script src="js/modernizr-2.6.2.min.js"></script>
    <!-- FOR IE9 below -->
    <!--[if lt IE 9]>
    <script src="js/respond.min.js"></script>
    <![endif]-->

    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js" ></script>
    <script type="text/javascript" src="https://cdn.iamport.kr/js/iamport.payment-1.1.5.js"></script>


    <title></title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap');
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap" rel="stylesheet">
    <style>
        h1, h2, h3, h4, h5, h6, span, p, a, label, input, textarea, button {
            font-family: 'Gowun Dodum', sans-serif !important;
            font-size: large !important;
            letter-spacing: 0rem; !important;
        }
    </style>

    <link rel="stylesheet" href="css/modal.css">

</head>
<style th:replace="mouse.html :: style"></style>
<body th:if="${session.login ne null}">
<div id="colorlib-page">
    <a href="#" class="js-colorlib-nav-toggle colorlib-nav-toggle"><i></i></a>

    <header th:replace="sider.html :: header"></header>

    <div id="colorlib-main">
<div id="mainCoantiner">
    <!--dust particel-->
    <div class="margin-body">

        <div>
            <div class="starsec"></div>
            <div class="starthird"></div>
            <div class="starfourth"></div>
            <div class="starfifth"></div>
        </div>
        <!--Dust particle end--->

        <div class="row">
            <div class="col-sm-12 col-md-12">
                <div class="wpb_text_column wpb_content_element ">
                    <div class="wpb_wrapper">
                        <div class="title-h1 text-center"><span><span class="light">멤버쉽 </span> 구매 페이지</span></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-3 col-md-3 pricing-column-wrapper" style="margin-left: 37%;">
                <div class="pricing-column">
                    <div class="pricing-price-row">
                        <div class="pricing-price-wrapper">
                            <div class="pricing-price">
                                <div style=" " class="pricing-cost">VIP</div>
                                <div class="time" style="display:inline-block;">12 Month</div>
                            </div>
                        </div>
                    </div>
                    <div class="pricing-row-title">
                        <div class="pricing_row_title">100000원</div>
                    </div>
                    <figure class="pricing-row">VIP 초대권입니다.</figure>
                    <figure class="pricing-row"><span style="color: #5f727f;">멤버쉽을 구매해야만 상품 등록이 가능합니다.</span></figure>
                    <figure class="pricing-row"><span style="color: #5f727f;">멋진 VIP 아이콘을 프로필에 달 수 있습니다.</span></figure>
                    <figure class="pricing-row strike">Crush revenue traction</figure>
                    <figure class="pricing-row strike">User base minimum</figure>
                    <figure class="pricing-row strike">Lorem ipsum dolor</figure>
                    <div class="pricing-footer">
                        <div class="gem-button-container gem-button-position-center"><a onclick="kPay(100000)" class="gem-button gem-green" style="border-color: #00bcd4;">order now</a></div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
    </div>
</div>
<!-- jQuery -->
<script src="js/jquery.min.js"></script>
<!-- Bootstrap -->
<script src="js/bootstrap.min.js"></script>
<!-- Waypoints -->
<script src="js/jquery.waypoints.min.js"></script>
<!-- Flexslider -->
<script src="js/jquery.flexslider-min.js"></script>
<!-- Sticky Kit -->
<script src="js/sticky-kit.min.js"></script>
<!-- Owl carousel -->
<script src="js/owl.carousel.min.js"></script>
<!-- Counters -->
<script src="js/jquery.countTo.js"></script>


<!-- MAIN JS -->
<script src="js/main.js"></script>

<script src="js/modal.js"></script>

</body>
<script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js" ></script>
<script>

    function kPay(salPrice) {

        let memPoint = parseInt('[[${session.login.memPoint}]]');           // 현재 회원의 보유 포인트



        let memCode =[[${session.login.memCode}]];  // 회원의 코드

        if(true){
            $(function () {

                var IMP = window.IMP; // 생략가능
                IMP.init('앱키'); // 'iamport' 대신 부여받은 "가맹점 식별코드"를 사용
                var msg;

                IMP.request_pay({
                    pg: 'kakaopay',
                    pay_method: 'card',
                    merchant_uid: 'merchant_' + new Date().getTime(),
                    name: '멤버쉽 결제',
                    amount: salPrice,
                    buyer_email: '이메일',
                    buyer_tel: '전화번호',
                    buyer_addr: '집주소',
                    buyer_postcode: '123-456',
                    //m_redirect_url : 'http://www.naver.com'
                }, function (rsp) {
                    if (rsp.success) {
                        //[1] 서버단에서 결제정보 조회를 위해 jQuery ajax로 imp_uid 전달하기
                        jQuery.ajax({
                            url: "/payments/complete", //cross-domain error가 발생하지 않도록 주의해주세요
                            type: 'POST',
                            dataType: 'json',
                            data: {
                                imp_uid: rsp.imp_uid
                                //기타 필요한 데이터가 있으면 추가 전달
                            }
                        }).done(function (data) {
                            //[2] 서버에서 REST API로 결제정보확인 및 서비스루틴이 정상적인 경우
                            if (everythings_fine) {
                                msg = '결제가 완료되었습니다.';
                                msg += '\n고유ID : ' + rsp.imp_uid;
                                msg += '\n상점 거래ID : ' + rsp.merchant_uid;
                                msg += '\n결제 금액 : ' + rsp.paid_amount;
                                msg += '카드 승인번호 : ' + rsp.apply_num;

                                alert(msg);
                            } else {
                                //[3] 아직 제대로 결제가 되지 않았습니다.
                                //[4] 결제된 금액이 요청한 금액과 달라 결제를 자동취소처리하였습니다.
                            }
                        });
                        //성공시 이동할 페이지
                        /*location.href='<%=request.getContextPath()%>/order/paySuccess?msg='+msg;*/
                        alert('결제가 완료됐습니다.');
                        location.href = "PAY008?salMemCode="+memCode+"&salContent=멤버쉽구매&salName=멤버쉽&salPrice="+ salPrice;
                    } else {
                        msg = '결제에 실패하였습니다.';
                        msg += '에러내용 : ' + rsp.error_msg;
                        //실패시 이동할 페이지
                        location.href = "<%=request.getContextPath()%>/order/payFail";
                        alert(msg);
                    }
                });

            });
        } else {
            alert('포인트가 ' + (salPrice - memPoint) + '원 부족합니다.');
            location.href = "Pay_Membership";
        }
    }





</script>
</html>