<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="apple-touch-icon" sizes="76x76" href="img/apple-icon.png">
    <link rel="icon" type="image/png" href="../assets/img/favicon.png">
    <!-- Nucleo Icons -->

    <!-- Animate.css -->

    <link href="css/profile/nucleo-icons.css" rel="stylesheet"/>
    <link href="css/profile/nucleo-svg.css" rel="stylesheet"/>

    <script src="https://kit.fontawesome.com/8591377d67.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://kit.fontawesome.com/8591377d67.css" crossorigin="anonymous">

    <link rel="stylesheet" href="css/main/animate.css">
    <!-- Icomoon Icon Fonts-->
    <link rel="stylesheet" href="css/main/icomoon.css">
    <!-- Bootstrap  -->
    <link rel="stylesheet" href="css/main/bootstrap.css">
    <!-- Flexslider  -->
    <link rel="stylesheet" href="css/main/flexslider.css">
    <!-- Flaticons  -->
    <link rel="stylesheet" href="fonts/flaticon/font/flaticon.css">
    <!-- Owl Carousel -->
    <link rel="stylesheet" href="css/main/owl.carousel.min.css">
    <link rel="stylesheet" href="css/main/owl.theme.default.min.css">
    <!-- Theme style  -->
    <link rel="stylesheet" href="css/main/style.css">

    <link rel="stylesheet" href="css/header.css">

    <link href="css/category.css" rel="stylesheet"/>
    <!-- Font Awesome Icons -->
    <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <!-- CSS Files -->

    <link id="pagestyle" href="css/profile/material-kit.css?v=3.0.4" rel="stylesheet"/>

    <!--     Fonts and icons     -->
    <link rel="stylesheet" type="text/css"
          href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900|Roboto+Slab:400,700"/>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap" rel="stylesheet">


    <!--모달 css-->
    <style>
        .fishModal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgb(0, 0, 0); /* Fallback color */
            background-color: rgba(0, 0, 0, 0.4); /* Black w/ opacity */
        }

        /* Modal Content/Box */
        .fishModal-content {
            background-color: black;
            margin: 5% auto; /* 15% from the top and centered */
            border: 1px solid black;
            width: 65%; /* Could be more or less, depending on screen size */
            text-align: center;
            position: relative;
        }

        /* The Close Button */
        .fishClose {
            color: white;
            float: right;
            font-size: 32px;
            font-weight: bold;
            text-align: right;
            margin-right: 15px;
            margin-top: 15px;
            position: absolute;
            z-index: 1;
            right: 0px;
        }

        .fishClose:hover,
        .fishClose:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
    <style>
        .followDiv {
            overflow: scroll;
            height: 700px;
        }
    </style>


</head>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap');
</style>
<link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap" rel="stylesheet">
<style>
    h1, h2, h3, h4, h5, h6, span, p, a, label, input, textarea, button {
        font-family: 'Gowun Dodum', sans-serif !important;
        font-size: large !important;
        letter-spacing: 0rem; !important;
    }
</style>
<style th:replace="mouse.html :: style"></style>

<link rel="stylesheet" href="css/modal.css">
<body class="blog-author bg-gray-200">
<div id="colorlib-page">
    <a href="#" class="js-colorlib-nav-toggle colorlib-nav-toggle"><i></i></a>

    <header th:replace="sider.html :: header" style="font-family: 'Gowun Dodum', sans-serif; !important;"></header>


    <div id="colorlib-main">

        <!-- -------- END HEADER 4 w/ search book a ticket form ------- -->
        <div class="card card-body blur shadow-blur mx-3 mx-md-4 mt-n6 mb-4">
            <div>
                <div class="colorlib-blog" data-animate-effect="fadeInLeft">
                    <div class="colorlib-narrow-content">
                        <div class="col-md-6 col-md-offset-3 col-md-pull-3 animate-box" data-animate-effect="fadeInLeft">
                            <h2 class="colorlib-heading">피드</h2>
                        </div>
                        <div class="row1" id="workspaceBoard">

                        </div>
                    </div>
                </div>


                <!--   Core JS Files   -->
                <script src="js/core/popper.min.js" type="text/javascript"></script>
                <script src="js/core/bootstrap.min.js" type="text/javascript"></script>
                <script src="js/plugins/perfect-scrollbar.min.js"></script>
                <!--  Plugin for Parallax, full documentation here: https://github.com/wagerfield/parallax  -->
                <script src="js/plugins/parallax.min.js"></script>
                <!-- Control Center for Material UI Kit: parallax effects, scripts for the example pages etc -->
                <!--  Google Maps Plugin    -->
                <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDTTfWur0PDbZWPr7Pmq8K3jiDp0_xUziI"></script>
                <script src="js/material-kit.min.js?v=3.0.4" type="text/javascript"></script>

                <!-- jQuery -->
                <script src="js/jquery.min.js"></script>
                <!-- jQuery Easing -->
                <script src="js/jquery.easing.1.3.js"></script>
                <!-- Bootstrap -->
                <script src="js/bootstrap.min.js"></script>
                <!-- Waypoints -->
                <script src="js/jquery.waypoints.min.js"></script>
                <!-- Flexslider -->
                <script src="js/jquery.flexslider-min.js"></script>
                <!-- Sticky Kit -->
                <script src="js/sticky-kit.min.js"></script>
                <!-- Owl carousel -->
                <script src="js/owl.carousel.min.js"></script>
                <!-- Counters -->
                <script src="js/jquery.countTo.js"></script>


                <!-- MAIN JS -->
                <script src="js/main.js"></script>

                <script src="js/modal.js"></script>
            </div>
        </div>
    </div>
</div>
<div id="endWorkspaceBoard"></div>
</body>
<script>
    // 회원코드
    let memCode = "[[${session.login.memCode}]]";

    // 페이징
    let page = 1;
    let endPage = 0;

    // 스크롤 조회를 할 수 있는가?
    let scrollSelect = false;   // true일때 스크롤 조회


    // 처음 페이지 실행시 보드 불러오기
    getBoard();


    // 게시물 불러오기
    function getBoard() {
        $.ajax({
            type: "POST",
            url: "ProfileFollowBoard",
            data: {
                "memCode": memCode,
                "page": page
            },
            async: false,
            dataType: "json",
            success: function (result) {
                console.log(result[0]);
                console.log(result[1]);

                page = result[0].page;
                endPage = result[0].endpage;

                //console.log("바뀐 page:"+page);
                //console.log("현재페이지"+(page-1));
                //console.log("바뀐 endPage:"+endPage);
                innerBoard(result[1]);
            },
            error: function () {
                alert("통신실패");
            }

        });
    }

    // 게시물 넣기
    function innerBoard(result) {
        let output = "";

        for (let i in result) {
            output +=
                "<div class=\"col-md-3 animate-box\" data-animate-effect=\"fadeInLeft\" style='width: 32%; height: 500px;'>" +
                "<div class=\"project\" style=\"background-image: url(PSW/bestimg/" + result[i].boaBestImg + "); height: 90%;\">" +
                "<div class=\"desc\">" +
                "<a href='DRA004?boaCode=" + result[i].boaCode + "'>" +
                "<div style='width: 100%; height: 100%;' class=\"con\">" +

                "<span>" + result[i].boaTitle + "</span>" +
                "</br>" +
                "<span>" + result[i].memName + "</span>" +
                "<span>" + result[i].boaTag + "</span>" +
                "<p class=\"icon\">" +
                "<span><i class=\"icon-eye\"></i> " + result[i].boaHit + "</span>" +
                "<span><i class=\"icon-heart\"></i>" + result[i].likeNum +  "</span>" +
                "</p>" +

                "</div>" +
                "</a>" +
                "</div>" +
                "</div>" +
                "</div>";
        }
        $('#workspaceBoard').append(output);
        //console.log("append 적용");
        scrollSelect = true;
    }


</script>
<script>
    // 스크롤 조회
    window.addEventListener('scroll', function () {
        if (scrollSelect && ((page - 1) <= endPage)) {
            //console.log("중간실행 성공");
            let posY = this.window.pageYOffset;
            let wb = this.document.querySelector('#endWorkspaceBoard').getBoundingClientRect().bottom;

            if (posY > wb) {
                // 게시물 조회
                scrollSelect = false;
                getBoard();
            }
        }
    });
</script>

</html>